<?xml version="1.0" encoding="UTF-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="CopyPlaywrightFilesToOutput" AfterTargets="CopyFilesToOutputDirectory">
    <ItemGroup>
      <_CopyItems Include="$(MSBuildThisFileDirectory)..\..\Drivers\**" />
    </ItemGroup>
    <Message Text="[Playwright] Copying drivers from $(MSBuildThisFileDirectory) to $(OutputPath)..." />
    <Copy SourceFiles="@(_CopyItems)" DestinationFiles="@(_CopyItems->'$(OutDir).playwright\%(RecursiveDir)%(Filename)%(Extension)')"/>
  </Target>
  <Target Name="InstallBrowsers" AfterTargets="CopyPlaywrightFilesToOutput">
    <Message Text="[Playwright] Install browsers..."/>
    <Message Text="[Playwright] $(MSBuildThisFileDirectory)"/>
    <Exec Condition="$([MSBuild]::IsOSPlatform('Linux'))" WorkingDirectory="$(OutDir).playwright\linux$(NativeFolder)" Command="./playwright.sh install" />
    <Exec Condition="$([MSBuild]::IsOSPlatform('OSX'))" WorkingDirectory="$(OutDir).playwright\mac$(NativeFolder)" Command="./playwright.sh install" />
    <Exec Condition="'$(PlatformTarget)' != 'x86' AND $([MSBuild]::IsOSPlatform('Windows'))" WorkingDirectory="$(OutDir).playwright\win32_x64$(NativeFolder)" Command="playwright.cmd install" />
    <Exec Condition="'$(PlatformTarget)' == 'x86' AND $([MSBuild]::IsOSPlatform('Windows'))" WorkingDirectory="$(OutDir).playwright\win32$(NativeFolder)" Command="playwright.cmd install" />
  </Target>
</Project>
